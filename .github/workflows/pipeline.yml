name: Deployment pipeline

on:
  push:
    branches:
      - main

jobs:
 simple_deployment_pipeline:
   runs-on: ubuntu-20.04
   steps:
   - uses: actions/checkout@v4
   - uses: actions/setup-node@v4
     with:
      node-version: '20'
   - name: Install dependencies
     run: npm install
     working-directory: full-stack-open-pokedex
   - run: npm run eslint --fix
     working-directory: full-stack-open-pokedex
   - run: npm run build
     working-directory: full-stack-open-pokedex
   - run: npm test
     working-directory: full-stack-open-pokedex
   - name: e2e tests
     uses: cypress-io/github-action@v5
     with:
      working-directory: full-stack-open-pokedex
      command: npm run cypress:run
      start: npm run start-prod
      wait-on: http://localhost:5000
